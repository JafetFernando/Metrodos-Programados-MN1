<!DOCTYPE html>

<html>

<head>
    <link rel="stylesheet" href="/static/styles.css">
    <title>Sistemas de Ecuaciones Lineales</title>

    <!-- Estilos locales para las tablas y el ajuste -->
    <style>
        /* Estilo para las tablas de resultados */
        
        .resultado-tabla {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 0.9em;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .resultado-tabla th,
        .resultado-tabla td {
            border: 1px solid #ddd;
            padding: 10px 15px;
            text-align: right;
        }
        
        .resultado-tabla th {
            background-color: #007bff;
            /* Color de encabezado */
            color: white;
            text-align: center;
        }
        
        .resultado-tabla tr:nth-child(even) {
            background-color: #f8f8f8;
            /* Raya de cebra */
        }
        /* Estilo para matrices de Gauss */
        
        .matrix-display {
            font-family: 'Consolas', 'Courier New', monospace;
            white-space: pre-wrap;
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #007bff;
            /* Borde de color */
            overflow-x: auto;
            margin-bottom: 20px;
        }
        /* Estilo de PRE corregido para ajuste */
        
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
        
        h2,
        h3 {
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }
    </style>


</head>

<body>

    <h1>Sistemas de Ecuaciones Lineales</h1>

    <form method="POST">
        <h3>Seleccione el método:</h3>
        <select name="metodo" class="select">
<option value="gauss" {% if metodo_usado == 'gauss' %}selected{% endif %}>Gauss (Eliminación)</option>
<option value="jacobi" {% if metodo_usado == 'jacobi' %}selected{% endif %}>Jacobi (Iterativo)</option>
<option value="gauss_seidel" {% if metodo_usado == 'gauss_seidel' %}selected{% endif %}>Gauss-Seidel (Iterativo)</option>


</select>

        <h3>Seleccione el sistema:</h3>
        <select name="sistema" class="select">
<option value="s1">Sistema 1 (10x1 + 2x2 + 1x3 = 14)</option>
<option value="s2">Sistema 2 (4x1 - 1x2 + 1x3 = 7)</option>


</select>

        <br><br>
        <button class="btn" type="submit">Calcular</button>
    </form>

    {% if datos_resultado %}

    <!-- 1. Mostrar el Sistema Seleccionado -->
    {% if sistema_texto %}
    <h2>Método: {{ metodo_usado.replace('_', ' ').title() }}</h2>
    <h3>Sistema a Resolver:</h3>
    <pre>{{ sistema_texto }}</pre> {% endif %}

    <!-- MANEJO DE ERRORES -->
    {% if datos_resultado.error %}
    <h2 style="color: red;">Error:</h2>
    <pre>{{ datos_resultado.error }}</pre> {% else %}

    <h2>Proceso de Cálculo</h2>

    <!-- RENDERIZADO PARA GAUSS -->
    {% if metodo_usado == 'gauss' %} {% for paso in datos_resultado.proceso_gauss %}
    <h3>Paso {{ loop.index }}: {{ paso.paso }}</h3>
    <p>Multiplicador $\mathbf{m_{{ paso.row_modificada }}{{ paso.row_pivot }}}$: <span style="font-weight: bold; color: #007bff;">{{ paso.multiplicador }}</span></p>

    <!-- LÍNEA CORREGIDA: Se usa la operación de fila correcta y se elimina el filtro 'add' -->
    <p>Matriz Aumentada antes de la operación ($\mathbf{R_{{ paso.row_modificada }} \rightarrow R_{{ paso.row_modificada }} - m \cdot R_{{ paso.row_pivot }}}$):</p>
    <div class="matrix-display">
        <!-- Itera sobre las filas de la matriz -->
        {% for i in range(paso.matriz|length) %} {% for j in range(paso.matriz[i]|length) %}
        <!-- Formato para alinear números -->
        {{ "%10.4f" | format(paso.matriz[i][j]) }} {% endfor %}
        <!-- Separador para el vector b -->
        | {{ "%10.4f" | format(paso.vector[i]) }}
        <br> {% endfor %}
    </div>
    {% endfor %}

    <!-- Resultado de la Eliminación -->
    <h3>Matriz Triangular Superior Final</h3>
    <div class="matrix-display">
        {% for i in range(datos_resultado.matriz_triangular|length) %} {% for j in range(datos_resultado.matriz_triangular[i]|length) %} {{ "%10.4f" | format(datos_resultado.matriz_triangular[i][j]) }} {% endfor %} | {{ "%10.4f" | format(datos_resultado.vector_final_b[i])
        }}
        <br> {% endfor %}
    </div>

    <!-- Sustitución Regresiva (Pasos) -->
    <h3>Pasos de Sustitución Regresiva</h3>
    <pre>{{ datos_resultado.sustitucion_regresiva | join("\n") }}</pre>


    <!-- RENDERIZADO PARA JACOBI Y GAUSS-SEIDEL -->
    {% elif metodo_usado == 'jacobi' or metodo_usado == 'gauss_seidel' %}

    <table class="resultado-tabla">
        <thead>
            <tr>
                <th>Iteración (k)</th>
                {% for var in datos_resultado.variables %}
                <th>{{ var }}</th>
                {% endfor %}
                <th>Error Absoluto Máximo (TOL)</th>
            </tr>
        </thead>
        <tbody>
            {% for iteracion in datos_resultado.proceso_iterativo %}
            <tr>
                {% for valor in iteracion %}
                <td>
                    {% if loop.index == 1 %}
                    <!-- La primera columna es el índice de la iteración -->
                    {{ valor }} {% else %}
                    <!-- Las demás son valores de x y el error -->
                    {{ "%10.6f" | format(valor) }} {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if datos_resultado.convergio %}
    <p style="color: green; font-weight: bold;">
        ✅ El método convergió en $\mathbf{k = {{ datos_resultado.iteraciones_usadas }}}$ iteraciones.
    </p>
    {% else %}
    <p style="color: red; font-weight: bold;">
        ❌ El método alcanzó el máximo de iteraciones ({{ datos_resultado.iteraciones_usadas }}) y no convergió.
    </p>
    {% endif %} {% endif %}

    <!-- 2. Mostrar la Solución Final (para todos los métodos) -->
    <h2>Solución Final</h2>
    <p>El vector solución $\mathbf{x}$ es:</p>
    <div class="matrix-display">
        {% for valor in datos_resultado.solucion_final %} x{{ loop.index }} = {{ "%10.6f" | format(valor) }}<br> {% endfor %}
    </div>

    {% endif %} {% endif %}

    <br>
    <a class="btn" href="/menu">Regresar al menú</a>


</body>

</html>